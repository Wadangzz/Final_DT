# 🎮 Final_DT
![image](https://github.com/user-attachments/assets/07918e17-1427-4638-93a5-cf57322e74ec)


## 📘 프로젝트 개요

**Final_DT**는 Solidworks Modeling을 Unity에 Import하여  
**PLC에서 Modbus TCP로 수신한 데이터를 기반으로 Unity 오브젝트를 제어**하고,  
**충돌 이벤트를 통해 오브젝트 생성/삭제, 카메라 시점 변경**을 구현한 **Digital Twin 프로젝트**입니다.

---

## ❓ Why Unity?

초기에는 SCADA 기반 시스템으로 TAG 값을 수집해 시각화하는 방식까지 구현했지만,  
실제 물리 모델과 상호작용하는 **CPS(Cyber Physical System)** 구조와  
**3D 시뮬레이션 기반의 Digital Twin** 기술이 산업 전반에서 중요해지는 흐름에 주목하게 되었습니다.

이에 따라 **물리 엔진 기반의 실시간 시각화 환경을 구축해보는 것을 추가 목표**로 설정하였고,  
여러 엔진 중 **Unity**엔진이 관련 자료를 수집하기 용이하여 Unity를 채택하게 되었습니다.

---

## 🔧 주요 기능

### 🧩 1. Modbus TCP 연동 (NModbus)
- Unity에서 **NModbus 패키지**를 활용하여 **Modbus Master**로 동작
- PLC_NModbus(서버)에서 데이터를 읽어 **Unity 내부 GameObject의 상태를 실시간으로 제어**
- `coils`, `registers`, `joints`, `servo`, `cylinder` 등의 값 반영

### 🧠 2. 실시간 시뮬레이션 연동
- **ServoTower 위치 이동**, **Cylinders 동작**, **Robot 관절 각도(joint) 제어**
- 오브젝트 위치, 속도, 상태가 실시간 Modbus 값에 따라 업데이트됨

### 🎯 3. 충돌 기반 이벤트 트리거
- 특정 위치에서 충돌(`Collider Trigger`) 발생 시:
  - 특정 위치에 **새로운 Object 생성**
  - 흡착, 그리퍼 **Pick&Place 구현**

---

## 🗂️ 주요 구성 요소(Assets/Script)

| 구성 요소 | 설명 |
|-----------|------|
| `DT_TEST.cs` | Modbus TCP 연동 및 전체 오브젝트 제어 로직 담당 |
| `ConveyorItem.cs` | 이동 대상 오브젝트의 충돌, 삭제 조건 처리 |
| `ObjectReset.cs` | 특정 위치에서 셀, 캡 등 오브젝트 자동 제거 |
| `CameraControl.cs` | 조건에 따른 카메라 시점 전환 |
| `NModbus.dll` | Unity C#에서 Modbus TCP 통신을 위한 .NET 라이브러리 |
| FBX Assets | Conveyor, Robot, Cap 등 실제 라인 구성 요소의 3D 모델 |

---

## 🔄 시스템 동작 요약

| **단계**                            | **동작 내용** |
|------------------------------------|----------------|
| **Modbus Slave 서버에서 데이터 읽기** | PLC 상태값(Coils, Registers 등) 수신 |
| **PLC 상태 반영**                  | 수신한 값을 기반으로 Unity 내 제어 로직 반영 |
| **Unity 오브젝트 실시간 제어**      | 실린더, 서보, 로봇 등의 위치·회전 제어 |
| **충돌 발생**                      | Trigger(Collider) 이벤트 감지 |
| **오브젝트 동작 처리**             | `Cell`, `Case`, `Cap` 오브젝트 삭제 및 새 오브젝트 생성 |

---

## 🐞 Trouble Shooting

### 🌀 1. 로봇 및 서보 오브젝트 회전 오류 (좌표축 불일치)

**문제**  
SolidWorks에서 모델링한 FBX 파일을 Unity로 임포트한 후,  
서버에서 수신한 정보(로봇의 축 각도, 서보 모터의 위치) 기준으로 오브젝트를 회전시키려 했으나  
**회전 좌표축이 실제 로봇의 물리 회전축과 달라 의도한 동작이 발생하지 않는 문제**가 있었습니다.

**해결방법**  
Unity Hierarchy 내에서 **빈 GameObject를 생성해 기준 좌표축을 수동 보정**한 후,  
회전, 직선 운동이 필요한 모델(FBX)을 **빈 오브젝트의 자식으로 설정(Parenting)** 하여  
회전 기준축을 간접적으로 제어할 수 있도록 구조를 재구성했습니다.

**결과**  
로봇과 서보 모터 오브젝트가 **실제 물리 구조와 동일한 방식**으로 움직이게 되었으며,  
서버 측 joint angle 값과 시각적 동작이 일치하도록 개선할 수 있었습니다.

---

## 💡 To Me

Final_DT 프로젝트는 기존의 제어 중심 자동화 시스템에서 한 단계 더 나아가,  
**실제 제어 데이터를 기반으로 동작하는 3D 디지털 트윈 환경을 구현**해본 첫 경험이었습니다.

Unity와 Modbus TCP 연동을 통해 **PLC 상태를 실시간으로 시각화하고 오브젝트를 제어**하는 구조를 직접 설계하면서,  
단순한 3D 표현을 넘어 **현실 기반 데이터와 가상 모델을 연결하는 구조적 사고**를 기를 수 있었습니다.

특히 좌표축 오차로 인해 모델이 의도와 다르게 움직이는 문제를 해결하기 위해  
**Hierarchy 구조와 기준 오브젝트를 활용한 좌표계 보정 방식**을 적용한 경험은,  
**3D 물리 환경과 자동화 데이터를 함께 고려하는 설계 역량**을 키우는 계기가 되었습니다.

이 프로젝트를 통해 향후 **현실 공정 데이터를 시각화하고 예측/제어까지 가능한 통합형 Digital Twin 시스템**을  
직접 기획하고 구현할 수 있는 기반을 마련했다고 생각합니다.
